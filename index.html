<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MonPixels</title>
  <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js" type="application/javascript"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; margin: 0; padding: 0; }
    #container { max-width: 900px; margin: 40px auto; background: white; padding: 24px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.12);}
    #grid { display: grid; grid-template-columns: repeat(10, 40px); grid-gap: 2px; margin-bottom: 32px;}
    .pixel { width: 40px; height: 40px; border: 1px solid #ddd; cursor: pointer; }
    #colorPicker { margin-bottom: 32px; }
    #colorPicker div { display: inline-block; width: 32px; height: 32px; margin: 0 2px; border: 1px solid #ccc; cursor: pointer; }
    #walletAddress { margin-bottom: 16px; font-weight: bold;}
    #connectBtn, #disconnectBtn { padding: 8px 18px; margin: 0 4px; border-radius: 4px; border: none; cursor: pointer; }
    #connectBtn { background: #2081e2; color: white; }
    #disconnectBtn { background: #eee; color: #222; display: none;}
    #title { font-size: 2rem; font-weight: bold; margin-bottom: 16px; text-align: center;}
  </style>
</head>
<body>
  <div id="container">
    <div id="title">MonPixels - 100 Colors, 100 Unique Contracts</div>
    <div id="walletAddress">Wallet not connected</div>
    <button id="connectBtn">Connect Wallet</button>
    <button id="disconnectBtn">Disconnect Wallet</button>
    <div id="colorPicker"></div>
    <div id="grid"></div>
  </div>

  <script>
  // List of deployed colors/contracts
  const deployedColors = [
    {"color":"Indigo","address":"0x9ce6b77D49E1ed78d731E71380309e9428E33f69"},
    {"color":"Crimson","address":"0x7F5aeFf9403E1130FCA76A8E40fbdb8A7f25F905"},
    {"color":"Khaki","address":"0x45D39385440141b10F9C47db1d7E532dbEe5258D"},
    {"color":"Orchid","address":"0xfD8F8fA38EF8D68f200081331CdD6Ac10B91Af09"},
    {"color":"Plum","address":"0xfE95944231422305db178622717f8490b75Ff073"},
    {"color":"Tan","address":"0xfAe2b517941E5A6dD05810861dD86CECc52FBe0b"},
    {"color":"Mint","address":"0x2EC2A433be855067fB1C4b2E1244a531C4ca1585"},
    {"color":"Azure","address":"0x351e35725fbaFa2Cd7090f919C3a64e62eaa534D"},
    {"color":"Lavender","address":"0x6657Fd6f386FD30F945966aCbFc95c181f835612"},
    {"color":"Periwinkle","address":"0x549F529601083e7BaCcf283D97C5785119353fbd"},
    {"color":"SeaGreen","address":"0x3A03BBd4a0C0556ff737266234Dac7e91C0f6C18"},
    {"color":"DarkGreen","address":"0xd5063041A435f53887eAd752d18fE6035BAD33c0"},
    {"color":"DarkBlue","address":"0x6f3edEE4fBA76Ff6F3E27B1983F8f87f8e8d4371"},
    {"color":"DarkRed","address":"0x6416cA889D41B6a3E5c3B602300f2f53972800CF"},
    {"color":"LightBlue","address":"0x057fc1E2e6Feaba38FD0a706b9Fe023fD2709fbB"},
    {"color":"LightGreen","address":"0x136324a5C344Ba6f1EE3558fD851464438fB2e5C"},
    {"color":"LightPink","address":"0x0185bDF75618dCcB06948c5B2bBDc10f8E9d2F8C"},
    {"color":"LightGray","address":"0xeD90E92282B5B8A22423B1A8F9B09f7AAB9d2541"},
    {"color":"SlateBlue","address":"0xB686C1Dfc166e3F36ECF2C0074A7e5aE244f2489"},
    {"color":"DeepPink","address":"0xDEd1C084c7962dbE8c303717b7CF01346Dc49e46"},
    {"color":"Tomato","address":"0x3F14e0B1Eab2254dCFC37FDBA478Cfd9b399c600"},
    // ...add all 100 colors/contracts
  ];

  function normalizeColorName(name) {
    // Lowercase and remove spaces for CSS safe colors if needed
    return name.toLowerCase();
  }

  let provider;
  let signer;
  let userAddress = null;
  let selectedColorIndex = 0;
  let contracts = [];
  const grid = document.getElementById('grid');
  const colorPicker = document.getElementById('colorPicker');
  const walletAddressP = document.getElementById('walletAddress');
  const connectBtn = document.getElementById('connectBtn');
  const disconnectBtn = document.getElementById('disconnectBtn');

  // Format wallet address to show first 6 and last 6 characters
  function formatAddress(address) {
    if (!address || address.length <= 12) return address;
    return address.slice(0, 6) + '...' + address.slice(-6);
  }

  // Initialize contract instances for all deployed colors
  async function initContracts() {
    contracts = deployedColors.map(dc => new ethers.Contract(dc.address, paintABI, signer));
  }

  // Force switch to Monad Testnet (chainId = 10143 decimal = 0x279f)
  async function switchToMonadTestnet() {
    const chainIdHex = '0x279f'; // 10143 decimal in hex
    try {
      await window.ethereum.request({
        method: 'wallet_switchEthereumChain',
        params: [{ chainId: chainIdHex }]
      });
      return true;
    } catch (switchError) {
      // This error code means the chain is not added to MetaMask
      if (switchError.code === 4902) {
        try {
          await window.ethereum.request({
            method: 'wallet_addEthereumChain',
            params: [{
              chainId: chainIdHex,
              chainName: 'Monad Testnet',
              nativeCurrency: {
                name: 'MON',
                symbol: 'MON',
                decimals: 18
              },
              rpcUrls: ['https://testnet-rpc.monad.xyz'],
              blockExplorerUrls: ['https://testnet.monadexplorer.com']
            }]
          });
          return true;
        } catch (addError) {
          alert('Failed to add Monad Testnet: ' + addError.message);
          return false;
        }
      } else {
        alert('Failed to switch network: ' + switchError.message);
        return false;
      }
    }
  }

  // Connect wallet & ensure on Monad Testnet
  async function connectWallet() {
    if (!window.ethereum) {
      alert('MetaMask not detected');
      return;
    }
    try {
      // Request accounts
      await window.ethereum.request({ method: 'eth_requestAccounts' });

      // Switch to Monad Testnet
      const switched = await switchToMonadTestnet();
      if (!switched) {
        walletAddressP.textContent = 'Please switch to Monad Testnet';
        return;
      }

      provider = new ethers.BrowserProvider(window.ethereum);
      signer = await provider.getSigner();
      userAddress = await signer.getAddress();

      walletAddressP.textContent = 'Connected: ' + formatAddress(userAddress);
      connectBtn.textContent = 'Wallet Connected';
      connectBtn.disabled = true;
      disconnectBtn.style.display = 'inline-block';

      await initContracts();
    } catch (err) {
      alert('Wallet connection failed: ' + err.message);
    }
  }

  // Disconnect wallet (reset UI and variables)
  function disconnectWallet() {
    signer = null;
    userAddress = null;
    contracts = [];
    walletAddressP.textContent = 'Wallet not connected';
    connectBtn.textContent = 'Connect Wallet';
    connectBtn.disabled = false;
    disconnectBtn.style.display = 'none';
  }

  // Build color picker UI
  function buildColorPicker() {
    colorPicker.innerHTML = '';
    deployedColors.forEach((dc, i) => {
      const div = document.createElement('div');
      div.style.background = normalizeColorName(dc.color);
      div.title = dc.color;
      div.onclick = function() {
        selectedColorIndex = i;
        Array.from(colorPicker.children).forEach(e => e.style.border = '1px solid #ccc');
        div.style.border = '3px solid #2081e2';
      };
      if (i === selectedColorIndex) {
        div.style.border = '3px solid #2081e2';
      }
      colorPicker.appendChild(div);
    });
  }

  // Initialize grid
  function buildGrid() {
    grid.innerHTML = '';
    for (let i = 0; i < 100; i++) {
      const pixel = document.createElement('div');
      pixel.className = 'pixel';
      pixel.onclick = function() {
        alert('Feature: Paint pixel with color contract! (not implemented)');
      };
      grid.appendChild(pixel);
    }
  }

  // Event listeners
  connectBtn.onclick = connectWallet;
  disconnectBtn.onclick = disconnectWallet;

  // Initialize UI
  buildColorPicker();
  buildGrid();

  // Dummy ABI for demonstration (replace with your actual ABI)
  const paintABI = [
    // ...
  ];
  </script>
</body>
</html>
